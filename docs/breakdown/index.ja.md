# Breakdown 仕様書インデックス

このディレクトリには Breakdown
ツールの仕様書が含まれています。これらの仕様書は開発用の詳細とは別に、人間がまとめたユースケースや要求事項を元にした仕様書です。

## 目的・背景

Breakdown は Deno で実装された OSS
ツールで、プロジェクト管理のための階層的なタスク分解をサポートするプロンプト生成ツールです。このツールは、入力と条件に基づいて適切なプロンプトを生成し、AIシステムがそのプロンプトを使用してタスク分解を実行できるようにします。

### ツールの責務範囲

1. プロンプト生成に特化
   - 入力条件に基づく適切なプロンプトの選択
   - プロンプト内の変数置換処理
   - プロンプト内へのJSON Schema参照情報の埋め込み
   
2. 対象外の処理
   - Markdownの構造解析（パース処理）
   - 実際のタスク分解処理
   - JSONスキーマの解釈と検証
   - 入力値から出力値への変換処理（これはAIが行う）

### 処理の流れ

1. 入力パラメータの処理
   - コマンドライン引数の解析
   - オプションの検証
   
2. 必要なファイルの特定
   - プロンプトファイルの選択
   - プロンプトが参照するスキーマファイルの特定
   - 入出力パスの解決
   
3. プロンプト生成
   - プロンプトファイルの読み込み
   - 変数の置換処理
   - JSON Schema参照情報の埋め込み（AIが入出力の変換時に参照）
   
4. 結果の出力
   - 生成されたプロンプトの出力
   - エラー時の適切な処理

詳細は[breakdownの処理フロー](./overview/processing-flow.ja.md)を参照してください。

## 使用するJSRパッケージ

Breakdown は以下のJSRパッケージを使用して実装されています。
これらは重要なコア機能の一部であり、処理を明確な責務で分離する設計意図により、専用の外部パッケージとして切り出されています：

1. [@tettuan/breakdownconfig](https://jsr.io/@tettuan/breakdownconfig) - 設定管理
   - アプリケーションとユーザー設定の管理
   - 作業ディレクトリの設定
   - プロンプトとスキーマのディレクトリ設定
   - **プロファイルプレフィクスによる設定切り替えといった重要な処理を担うため、BreakdownConfigに切り出されています。この切り出し自体が重要な設計判断です。**

2. [@tettuan/breakdownparams](https://jsr.io/@tettuan/breakdownparams) - パラメータ処理
   - コマンドライン引数の解析
   - オプションの処理
   - パラメータのバリデーション
   - **CLIインターフェースの核となるパラメータ解析処理を担うため、独立したパッケージとして切り出されています。**

3. [@tettuan/breakdownprompt](https://jsr.io/@tettuan/breakdownprompt) - プロンプト処理
   - プロンプトファイルの読み込み
   - 変数置換
   - プロンプトの生成
   - **Breakdownツールの主機能であるプロンプト生成処理を担うため、専用パッケージとして切り出されています。**

4. [@tettuan/breakdownlogger](https://jsr.io/@tettuan/breakdownlogger) - ロギング機能
   - デバッグ情報の出力
   - エラー処理とログ記録
   - **診断・デバッグに不可欠なロギング機能を担うため、独立したパッケージとして切り出されています。**

## 仕様の概略

**提供する価値：**
Breakdown ツールは、処理方向型（DirectiveType）の値であるto、summary、defectなどの処理方向と、階層型（LayerType）の値であるproject、issue、taskの各階層を組み合わせたプロンプトを生成します。
これらの型の取りうる値は、user.ymlでユーザーが自由に定義・カスタマイズすることが可能です。
さらに、BreakdownConfigを使うことで、プロファイルプレフィクスを用いてDirectiveTypeとLayerTypeの組み合わせを、用途ごとに切り替えることができます。
例えば、デフォルトの`breakdown`プロファイルでは`to,summary,defect`のDirectiveTypeを使用し、`search`プロファイルでは`web,rag,db`のDirectiveTypeを使用するといった、異なる処理体系を適用することが可能になります。
コマンドラインインターフェース(CLI)を通じて、これらの処理方向と階層に対応するプロンプトの生成、要約用プロンプトの生成、
欠陥分析用プロンプトの生成などの機能を提供します。

**実際の処理内容：**

1. パラメータ処理
   - コマンドライン引数から処理内容を特定
   - 必要なファイルパスの解決
   
2. プロンプト生成
   - プロンプトファイルの選択と読み込み
   - 変数置換による動的な内容生成
   - スキーマ情報の埋め込み
   
3. 出力処理
   - 生成されたプロンプトの出力
   - エラー時の適切なフィードバック

## 目次

### 1. 概要・全体設計

> Breakdownツールの全体像、用語定義、アーキテクチャについて

- [用語集](./overview/glossary.ja.md) - ドメイン固有の用語と概念の定義
  - ディレクトリ構造とパス関連の用語
  - 設定と初期化に関する用語
  - 入力処理とプロンプト処理の用語
  - コマンドラインオプションの用語

- [処理フロー](./overview/processing-flow.ja.md) - Breakdownの内部処理フロー詳細
  - JSRパッケージの利用方法と初期化
  - コマンドライン引数の解析フロー
  - 設定ファイルの読み込みと処理
  - エラーハンドリングの基本方針

### 2. 設定管理

> アプリケーションとユーザー設定の管理について

- [アプリケーション設定](./configuration/app_config.ja.md) - 設定ファイルの準備と管理
  - アプリケーション設定ファイル（app.yml）の構成
  - ユーザー設定ファイル（user.yml）のカスタマイズ
  - 作業ディレクトリとプロンプトディレクトリの設定
  - スキーマディレクトリの構成管理
  - プロファイルプレフィクスによる設定切り替え

### 3. パラメータ・CLI

> コマンドライン引数とオプションの仕様について

- [基本コマンドと引数](./parameters/options.ja.md) - コマンドライン引数の仕様と使用方法
  - 基本的なCLIコマンドの使い方
  - オプションとパラメータの指定方法
  - ヘルプとバージョン情報の表示

- [CLIインターフェース](./parameters/cli.ja.md) - コマンドライン利用の詳細
  - 基本構文と引数
  - 標準入出力の扱い
  - エラー時の対処方法

### 4. テンプレート・スキーマ

> プロンプトテンプレートとJSONスキーマの管理について

- [アプリケーションプロンプト](./templates/app_prompt.ja.md) - プロンプトテンプレートの準備
  - プロンプトファイルの配置と命名
  - プロンプトテンプレートの変数仕様
  - カスタムプロンプトの作成方法
  - デバッグモードの利用

- [Schema配置](./templates/app_schema.ja.md) - JSONスキーマファイルの準備
  - スキーマファイルの構造と配置ルール
  - スキーマの命名規則
  - コマンドとレイヤーの組み合わせルール
  - JSONスキーマの定義方法

- [構築ルール](./templates/path.ja.md) - 設定とパラメータに応じたプロンプト引数の構築ルール
  - パス階層の基本構造
  - 入力ファイルのパス解決ルール
  - 出力ファイルのパス生成ルール
  - ハッシュ値生成の仕様とファイル名規則

### 5. ワークスペース・初期化

> プロジェクト環境の設定と初期化について

- [ワークスペース](./workspace/workspace.ja.md) - プロジェクト環境の設定
  - ディレクトリ構造の管理
  - 設定ファイルの配置
  - 環境固有の設定方法

- [初期化](./workspace/init.ja.md) - プロジェクトの初期化
  - 初期化プロセスの詳細
  - 設定ファイルの生成
  - ディレクトリ構造の作成

### 6. 技術仕様・内部処理

> システムの動作原理と開発者向けの技術詳細

- [要素構築](./technical/app_factory.ja.md) - スキーマとプロンプトの要素構築方法
  - PromptVariablesFactoryの責務と実装
  - パラメータ構築のルール
  - ファイルパスとディレクトリパスの生成
  - バリデーションと変換処理
  - パラメータオプションと予約変数の対応表

> **パス解決・パラメータ構築の一元化・設計方針については [要素構築](./technical/app_factory.ja.md) も参照してください。**

## 利用ガイド

Breakdownツールの基本的な利用方法については、以下をご参照ください：

- **基本的な使い方**: [基本コマンドと引数](./parameters/options.ja.md)
- **設定ファイルの準備**: [アプリケーション設定](./configuration/app_config.ja.md)
- **プロンプト・スキーマファイルの準備**: [Schema配置](./templates/app_schema.ja.md)、[アプリケーションプロンプト](./templates/app_prompt.ja.md)
- **プロジェクト環境の設定**: [ワークスペース](./workspace/workspace.ja.md)、[初期化](./workspace/init.ja.md)

これらの仕様書は、Breakdown ツールの利用者が機能を理解し、適切に設定・利用するための参考資料として提供されています。

## 実装上の注意点

### マークダウンパース処理について

Breakdown ツールでは、Markdownファイルの内容を構造的に parse
する必要はありません。以下の理由により、Markdown Parserの実装は不要です：

1. ファイル処理の目的
   - ファイルの読み込みは、テキストコンテンツとして扱えば十分
   - 構造的なパース処理は、機能要件に含まれていない

2. 既存パッケージの役割
   - `@tettuan/breakdownparams` - パラメータ処理のみを担当
   - `@tettuan/breakdownprompt` - プロンプトテキストの処理を担当
   - これらのパッケージで十分な機能を提供

3. parsing Markdown file is never required. If needed to so, use `BreakdownPrompt`. this is the only
   way to parsing md file.

---

[日本語](./index.ja.md) | [English](./index.md)
