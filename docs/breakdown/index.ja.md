# Breakdown 仕様書インデックス

このディレクトリには Breakdown
ツールの仕様書が含まれています。これらの仕様書は開発用の詳細とは別に、人間がまとめたユースケースや要求事項を元にした仕様書です。

## 目的・背景

Breakdown は Deno で実装された OSS
ツールで、プロジェクト管理のための階層的なタスク分解をサポートするプロンプト生成ツールです。このツールは、入力と条件に基づいて適切なプロンプトを生成し、AIシステムがそのプロンプトを使用してタスク分解を実行できるようにします。

### ツールの責務範囲

1. プロンプト生成に特化
   - 入力条件に基づく適切なプロンプトの選択
   - プロンプト内の変数置換処理
   - プロンプト内へのJSON Schema参照情報の埋め込み
   
2. 対象外の処理
   - Markdownの構造解析（パース処理）
   - 実際のタスク分解処理
   - JSONスキーマの解釈と検証
   - 入力値から出力値への変換処理（これはAIが行う）

### 処理の流れ

1. 入力パラメータの処理
   - コマンドライン引数の解析
   - オプションの検証
   
2. 必要なファイルの特定
   - プロンプトファイルの選択
   - プロンプトが参照するスキーマファイルの特定
   - 入出力パスの解決
   
3. プロンプト生成
   - プロンプトファイルの読み込み
   - 変数の置換処理
   - JSON Schema参照情報の埋め込み（AIが入出力の変換時に参照）
   
4. 結果の出力
   - 生成されたプロンプトの出力
   - エラー時の適切な処理

## 使用するJSRパッケージ

Breakdown は以下のJSRパッケージを使用して実装されています：

1. [@tettuan/breakdownconfig](https://jsr.io/@tettuan/breakdownconfig) - 設定管理
   - アプリケーションとユーザー設定の管理
   - 作業ディレクトリの設定
   - プロンプトとスキーマのディレクトリ設定

2. [@tettuan/breakdownparams](https://jsr.io/@tettuan/breakdownparams) - パラメータ処理
   - コマンドライン引数の解析
   - オプションの処理
   - パラメータのバリデーション

3. [@tettuan/breakdownprompt](https://jsr.io/@tettuan/breakdownprompt) - プロンプト処理
   - プロンプトファイルの読み込み
   - 変数置換
   - プロンプトの生成

4. [@tettuan/breakdownlogger](https://jsr.io/@tettuan/breakdownlogger) - ロギング機能
   - デバッグ情報の出力
   - エラー処理とログ記録

## 仕様の概略

**提供する価値：**
Breakdown ツールは、プロジェクト、イシュー、タスクという3つの階層に関するプロンプトを生成します。
コマンドラインインターフェース(CLI)を通じて、これらの階層に対応するプロンプトの生成、要約用プロンプトの生成、
欠陥分析用プロンプトの生成などの機能を提供します。

**実際の処理内容：**

1. パラメータ処理
   - コマンドライン引数から処理内容を特定
   - 必要なファイルパスの解決
   
2. プロンプト生成
   - プロンプトファイルの選択と読み込み
   - 変数置換による動的な内容生成
   - スキーマ情報の埋め込み
   
3. 出力処理
   - 生成されたプロンプトの出力
   - エラー時の適切なフィードバック

## 目次

### 基本仕様

0. [基本実装](./breakdown.ja.md) - コマンド実行の基本フロー
   - JSRパッケージの利用方法と初期化
   - コマンドライン引数の解析フロー
   - 設定ファイルの読み込みと処理
   - エラーハンドリングの基本方針

1. [アプリケーション設定](./app_config.ja.md) - 設定ファイルの読み込みと作業ディレクトリの管理
   - breakdownconfigモジュールの使用方法
   - アプリケーション設定とユーザー設定の階層構造
   - 作業ディレクトリとプロンプトディレクトリの設定
   - スキーマディレクトリの構成管理

2. [基本コマンドと引数](./options.ja.md) - コマンドライン引数の仕様と使用方法
   - breakdownparamsモジュールの実装
   - NoParamsResult、SingleParamResult、DoubleParamsResultの処理
   - コマンドライン引数のパース処理
   - ヘルプとバージョン情報の表示

3. [要素構築](./app_factory.ja.md) - スキーマとプロンプトの要素構築方法
   - PromptVariablesFactoryの責務と実装
   - パラメータ構築のルール
   - ファイルパスとディレクトリパスの生成
   - バリデーションと変換処理
   - パラメータオプションと予約変数の対応表についても記載

> **パス解決・パラメータ構築の一元化・設計方針については [app_factory.ja.md](./app_factory.ja.md) も参照してください。**

3-1. [構築ルール](./path.ja.md) - 設定とパラメータに応じたプロンプト引数の構築ルール -
パス階層の基本構造 - 入力ファイルのパス解決ルール - 出力ファイルのパス生成ルール -
ハッシュ値生成の仕様とファイル名規則

3-2. [Schema配置](./app_schema.ja.md) - Schema配置の基本ルール - スキーマファイルの構造と配置 -
スキーマの命名規則 - コマンドとレイヤーの組み合わせルール - JSONスキーマの定義方法

4. [アプリケーションプロンプト](./app_prompt.ja.md) - プロンプトファイルの置換処理と使用方法
   - breakdownpromptモジュールの利用
   - プロンプトマネージャーの設定と初期化
   - 変数置換の仕様と処理
   - デバッグモードの設定と利用

5. [テスト設定](./test/config.md) - テストディレクトリの永続性仕様
   - テストデータの永続化ルール
   - フィクスチャーの配置と管理
   - テスト環境の分離方針
   - 一時ファイルの扱い

6. [用語集](./glossary.md) - ドメイン固有の用語と概念の定義
   - ディレクトリ構造とパス関連の用語
   - 設定と初期化に関する用語
   - テストとデバッグ関連の用語
   - 入力処理とプロンプト処理の用語
   - モジュール構成と型定義の用語
   - エラー処理とコマンドラインオプションの用語

### 開発者向けドキュメント

7. [モジュール構成](./module.ja.md) - プロジェクトの構造とモジュール設計
   - プロジェクト構造とディレクトリ構成
   - 依存関係管理とJSRパッケージの利用
   - インターフェース定義とエラー処理
   - コーディング規約とベストプラクティス

8. [Import ポリシー](./import_policy.ja.md) - import 文の記述と依存関係の管理
   - import map の設定と使用
   - バージョン管理とセキュリティ
   - Web 標準 API の優先使用
   - トラブルシューティングとレビュー基準

9. [Denoベストプラクティス](./deno.ja.md) - Denoアプリケーションの開発ガイドライン
   - JSRパッケージの利用と公開
   - 依存関係の管理
   - テストとデバッグ
   - セキュリティとパフォーマンス

### 実装詳細

10. [CLIインターフェース](./cli.ja.md) - コマンドライン引数の詳細仕様
   - 基本構文と引数
   - オプション
   - 標準入出力の扱い
   - エラー処理

11. [ロギング](./logging.ja.md) - ロギング機能の仕様

- ログレベルと制御
- 出力フォーマット
- デバッグ方法
- テストでのロギング

12. [テスト仕様](./testing.ja.md) - テストの実装ガイドライン
    - テストディレクトリ構造
    - テスト実行手順
    - カバレッジ要件
    - デバッグとエラー処理

## CLI インターフェース仕様

CLIインターフェースの詳細な仕様については、[CLIインターフェース仕様](./cli.ja.md)を参照してください。

これらの仕様書は、Breakdown
ツールの開発者やユーザーが機能を理解し、適切に利用するための参考資料として提供されています。

## 実装上の注意点

### マークダウンパース処理について

Breakdown ツールでは、Markdownファイルの内容を構造的に parse
する必要はありません。以下の理由により、Markdown Parserの実装は不要です：

1. ファイル処理の目的
   - ファイルの読み込みは、テキストコンテンツとして扱えば十分
   - 構造的なパース処理は、機能要件に含まれていない

2. 既存パッケージの役割
   - `@tettuan/breakdownparams` - パラメータ処理のみを担当
   - `@tettuan/breakdownprompt` - プロンプトテキストの処理を担当
   - これらのパッケージで十分な機能を提供

3. parsing Markdown file is never required. If needed to so, use `BreakdownPrompt`. this is the only
   way to parsing md file.
