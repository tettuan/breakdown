# Breakdown 仕様書インデックス

このディレクトリには Breakdown ツールの仕様書が含まれています。これらの仕様書は**ドメイン駆動設計**の思想に基づき、ユーザーの価値創出とシステムの責務を明確に分離して構成されています。

## 目的・背景

Breakdown は Deno で実装された OSS ツールで、プロジェクト管理のための階層的なタスク分解をサポートするプロンプト生成ツールです。このツールは、入力と条件に基づいて適切なプロンプトを生成し、AIシステムがそのプロンプトを使用してタスク分解を実行できるようにします。

## 設計思想：ドメイン駆動設計による責務分離

### 核心ドメイン（Core Domain）

**プロンプト生成ドメイン**がBreakdownの存在価値です。以下の4つの境界コンテキストで構成されています：

1. **プロンプトパス決定ドメイン** - ユーザーの意図を正確なファイルパスに変換
2. **プロンプト変数生成ドメイン** - 入力データを完成されたプロンプト変数に変換
3. **パラメータ解析ドメイン** - CLI引数を型安全なドメインオブジェクトに変換
4. **設定管理ドメイン** - 環境固有の設定を統一的に管理

### 支援ドメイン（Supporting Domain）

**環境構築ドメイン**は、核心ドメインが機能するための基盤を提供します：

1. **ワークスペース管理** - プロジェクト環境の構築と管理
2. **テンプレート管理** - プロンプトテンプレートとスキーマファイルの配置
3. **初期化サービス** - プロジェクトの初期セットアップ

### 汎用ドメイン（Generic Domain）

**技術基盤ドメイン**は、システム全体の技術的な基盤を提供します：

1. **ファイルシステム操作**
2. **設定ファイル読み込み**
3. **エラーハンドリング**
4. **ログ出力**

### ツールの責務範囲

1. **プロンプト生成ドメイン**に特化
   - 入力条件に基づく適切なプロンプトの選択
   - プロンプト内の変数置換処理
   - プロンプト内へのJSON Schema参照情報の埋め込み
   
2. **対象外の処理**（他のドメインの責務）
   - Markdownの構造解析（パース処理）
   - 実際のタスク分解処理
   - JSONスキーマの解釈と検証
   - 入力値から出力値への変換処理（これはAIが行う）

### 処理の流れ

1. 入力パラメータの処理
   - コマンドライン引数の解析
   - オプションの検証
   
2. 必要なファイルの特定
   - プロンプトファイルの選択
   - プロンプトが参照するスキーマファイルの特定
   - 入出力パスの解決
   
3. プロンプト生成
   - プロンプトファイルの読み込み
   - 変数の置換処理
   - JSON Schema参照情報の埋め込み（AIが入出力の変換時に参照）
   
4. 結果の出力
   - 生成されたプロンプトの出力
   - エラー時の適切な処理

詳細は[breakdownの処理フロー](./overview/processing-flow.ja.md)を参照してください。

## 使用するJSRパッケージ

Breakdown は以下のJSRパッケージを使用して実装されています。
これらは重要なコア機能の一部であり、**ドメインの境界を明確にする設計意図**により、専用の外部パッケージとして切り出されています：

1. **[@tettuan/breakdownconfig](https://jsr.io/@tettuan/breakdownconfig)** - 設定管理ドメイン
   - アプリケーションとユーザー設定の統一管理
   - プロファイルプレフィクスによる設定切り替え
   - 作業ディレクトリとリソースディレクトリの設定

2. **[@tettuan/breakdownparams](https://jsr.io/@tettuan/breakdownparams)** - パラメータ解析ドメイン
   - コマンドライン引数の型安全な解析
   - オプションのバリデーション
   - パラメータの構造化

3. **[@tettuan/breakdownprompt](https://jsr.io/@tettuan/breakdownprompt)** - プロンプト生成ドメイン
   - プロンプトファイルの読み込み
   - 変数置換の実行
   - プロンプトの最終生成

4. **[@tettuan/breakdownlogger](https://jsr.io/@tettuan/breakdownlogger)** - 技術基盤ドメイン
   - 診断・デバッグ情報の出力
   - エラー処理とログ記録

## 仕様の概略

### 提供する価値

Breakdown ツールは、**DirectiveType**（処理方向）と**LayerType**（階層）の組み合わせによるプロンプト生成を核心価値として提供します。

- **DirectiveType**: `to`（変換）、`summary`（要約）、`defect`（欠陥検出）等
- **LayerType**: `project`（プロジェクト）、`issue`（課題）、`task`（タスク）等

これらの型の取りうる値は、`*-user.yml`でユーザーが自由に定義・カスタマイズ可能です。さらに、**BreakdownConfig**を使うことで、プロファイルプレフィクスを用いてDirectiveTypeとLayerTypeの組み合わせを用途ごとに切り替えることができます。

### 処理の流れ

1. **パラメータ解析** - CLI引数から型安全なドメインオブジェクトへ変換
2. **プロンプトパス決定** - ユーザーの意図を正確なファイルパスに変換
3. **プロンプト変数生成** - 入力データを完成されたプロンプト変数に変換
4. **プロンプト生成** - テンプレートと変数からプロンプトを生成
5. **出力処理** - 生成されたプロンプトの出力

## 目次

### 1. 核心ドメイン（Core Domain）

> Breakdownツールの存在価値を実現するドメイン

#### 1.1 ドメインの全体像
- **[ドメイン境界と協働](./domain_core/domain_boundaries_flow.ja.md)** - ドメイン間の境界と協働関係
  - 4つの境界コンテキスト
  - ドメインサービスの協働パターン
  - 責務分離の原則

#### 1.2 プロンプトパス決定ドメイン
- **[プロンプトパス決定](./domain_core/prompt_template_path.ja.md)** - ユーザーの意図を正確なファイルパスに変換
  - パス決定の確実性保証
  - 準備コストの非対称性への対応
  - フォールバック戦略

#### 1.3 プロンプト変数生成ドメイン
- **[プロンプト変数](./domain_core/prompt_variables.ja.md)** - 入力データの3段階変容
  - PromptVariableSource（生の材料）
  - PromptVariables（完成品）
  - PromptParams（最終形態）

#### 1.4 パラメータ解析ドメイン
- **[パラメータ型](./domain_core/two_params_types.ja.md)** - DirectiveTypeとLayerTypeの型安全な処理
  - TwoParamsの責務と構造
  - パターンベースバリデーション
  - ファイルシステムリソースへの変換

#### 1.5 設定管理ドメイン
- **[オプション型](./domain_core/option_types.ja.md)** - 設定とオプションの型安全な管理
  - PathResolutionOptionの責務
  - 設定値の階層化
  - 環境固有設定の統合

### 2. 支援ドメイン（Supporting Domain）

> 核心ドメインを支える環境構築ドメイン

#### 2.1 支援ドメインの全体像
- **[支援ドメイン概要](./supporting_domain/README.md)** - 支援ドメインの全体構成
  - テンプレート管理ドメイン
  - ワークスペース管理ドメイン
  - 初期化ドメイン

#### 2.2 テンプレート管理
- **[プロンプトテンプレート](./supporting_domain/template_management/app_prompt.ja.md)** - プロンプトテンプレートの配置と管理
  - テンプレートファイルの配置ルール
  - 変数仕様とカスタマイズ
  - デバッグモードの活用

- **[スキーマ管理](./supporting_domain/template_management/app_schema.ja.md)** - JSONスキーマファイルの配置と管理
  - スキーマファイルの構造と配置
  - 命名規則とディレクトリ構成
  - バリデーション設定

#### 2.3 ワークスペース管理
- **[ワークスペース](./supporting_domain/workspace_management/workspace.ja.md)** - プロジェクト環境の設定と管理
  - ディレクトリ構造の管理
  - 環境固有の設定方法
  - プロジェクト固有の設定

#### 2.4 初期化サービス
- **[初期化](./supporting_domain/initialization/init.ja.md)** - プロジェクトの初期化
  - 初期化プロセスの詳細
  - 設定ファイルの生成
  - ディレクトリ構造の作成

### 3. 利用者インターフェース層

> ユーザーとシステムの接点

#### 3.1 CLIインターフェース
- **[基本コマンド](./interface/cli_commands.ja.md)** - コマンドライン引数の仕様と使用方法
  - 基本的なCLIコマンドの使い方
  - オプションとパラメータの指定方法
  - エラー時の対処方法

#### 3.2 設定インターフェース
- **[設定管理](./interface/configuration.ja.md)** - 設定ファイルの準備と管理
  - アプリケーション設定（*-app.yml）
  - ユーザー設定（*-user.yml）
  - プロファイルプレフィクスによる切り替え
  - 初期値: "default" を用いる
    - `default-app.yml`
    - `default-user.yml`

#### 3.3 パス解決インターフェース
- **[パス解決ルール](./interface/path_resolution.ja.md)** - パラメータに応じたファイルパス解決
  - パス階層の基本構造
  - 入力・出力ファイルのパス解決
  - ハッシュ値生成とファイル名規則

### 4. 技術基盤ドメイン（Generic Domain）

> システム全体の技術的な基盤

#### 4.1 技術基盤の全体像
- **[技術基盤概要](./generic_domain/README.md)** - 技術基盤ドメインの全体構成
  - ファクトリードメイン
  - システムドメイン
  - エラーハンドリング

#### 4.2 ファクトリー
- **[ファクトリー](./generic_domain/factory/app_factory.ja.md)** - ドメインオブジェクトの構築
  - PromptVariablesFactoryの責務
  - パラメータ構築のルール
  - バリデーションと変換処理

#### 4.3 システム設計
- **[用語集](./generic_domain/system/overview/glossary.ja.md)** - ドメイン固有の用語と概念の定義
  - ディレクトリ構造とパス関連の用語
  - 設定と初期化に関する用語
  - 入力処理とプロンプト処理の用語
  - コマンドラインオプションの用語

- **[処理フロー](./generic_domain/system/overview/processing-flow.ja.md)** - Breakdownの内部処理フロー詳細
  - JSRパッケージの利用方法と初期化
  - コマンドライン引数の解析フロー
  - 設定ファイルの読み込みと処理
  - エラーハンドリングの基本方針

### 5. 概要・全体設計

> システムの全体像と設計思想（※技術基盤ドメインに移行済み）

- 上記の **[技術基盤ドメイン](#4-技術基盤ドメインgeneric-domain)** を参照してください

## 利用ガイド

### 初学者向け
1. **[基本コマンド](./interface/cli_commands.ja.md)** - コマンドの基本的な使い方
2. **[設定の準備](./interface/configuration.ja.md)** - 環境構築の手順
3. **[ワークスペース](./supporting_domain/workspace_management/workspace.ja.md)** - プロジェクト環境の設定

### 中級者向け
1. **[プロンプトテンプレート](./supporting_domain/template_management/app_prompt.ja.md)** - プロンプトとスキーマのカスタマイズ
2. **[スキーマ管理](./supporting_domain/template_management/app_schema.ja.md)** - JSONスキーマファイルの管理
3. **[パス解決](./interface/path_resolution.ja.md)** - ファイルパス解決の理解

### 上級者向け
1. **[ドメイン設計](./domain_core/domain_boundaries_flow.ja.md)** - システムアーキテクチャの理解
2. **[要素構築](./generic_domain/factory/app_factory.ja.md)** - 内部処理の詳細
3. **[処理フロー](./generic_domain/system/overview/processing-flow.ja.md)** - 全体の処理フローの理解

## 設計原則

### 1. ドメイン駆動設計の適用
- **核心ドメイン**の価値を最大化
- **境界コンテキスト**による責務分離
- **ユビキタス言語**による概念の統一

### 2. 型安全性の確保
- **Smart Constructors**による型安全な生成
- **パターンベースバリデーション**による信頼性保証
- **エラーファースト設計**による早期エラー発見

### 3. 拡張性の確保
- **プロファイル切り替え**による柔軟な設定
- **JSRパッケージ**による機能分離
- **テンプレート駆動**による機能拡張

### 4. ユーザー体験の最適化
- **確実性の保証**による問題切り分けの明確化
- **段階的変容**による理解しやすさ
- **明確なエラーメッセージ**による問題解決支援

---

この仕様書は、Breakdown ツールの利用者と開発者が、ドメインの価値と責務を正しく理解し、効果的に活用するための参考資料として提供されています。

---

[日本語](./index.ja.md) | [English](./index.md)
