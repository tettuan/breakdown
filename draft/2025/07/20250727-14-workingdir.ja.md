# 緊急修正指示書 - WorkspaceとWorkingDirのパス解決問題の修正案を作成

## 調査・修正案の作成方針

テンプレートパスの決定ロジックと設定ファイルの項目とCWDの存在が、複雑化している。
これらを調査し、1つのロジックに集約することを検討して欲しい。
(1)workspaeceとworking_dir, (2)設定ファイル内部の base_dir, app_prompt.base_dir, app_schema.base_dir, (3)CWD, (4)設定ファイル配置場所の関係性を整理する。

そのための情報収集を行い、(1)実装、(2)ドキュメント、(3)テストから網羅的に情報収集する。

作業着手前に、設計思想を理解する。
`Totality` について、必ず `docs/breakdown/generic_domain/system/overview/totality.ja.md` を参照すること。
ドメイン情報は、 `docs/breakdown/domain_core/domain_boundaries_flow.ja.md` および `docs/breakdown/domain_core/*` を必ず読むこと。
[TwoParams型システム](docs/breakdown/domain_core/two_params_types.ja.md)の設計に従い、DirectiveTypeとLayerTypeの組み合わせによるパス解決を正しく機能させる必要がある。

実装のAI複雑性制御は `docs/breakdown/domain_core/ai-complexity-control_compact.ja.md` の原則に従い、最小限の修正で最大の効果を得ること。


テスト方針:
テストに関しては `docs/tests/testing.ja.md` を読むこと。

仕様:
他の`docs/breakdown/*`資料は、適宜実装ファイルを変更するタイミングで読むこと。

### 問題の背景

examples/実行結果より、以下の問題が確認された：
1. 設定ファイル `app_prompt.base_dir` には "prompts" を記載すべきで、working_dir に ".agent/breakdown" を記載すべきで、両者を合わせてPATHが決まる、という結論が出た。
2. ドキュメントや既存実装には、`app_prompt.base_dir`には "./agent/breakdown/prompts" を記すケースがある。
3. workspace という概念も存在しており、何を信頼すべきか不明になっている。


## チームの構成

あなたは指揮官であり上司である。
最初にチームを立ち上げて進める。

`instructions/team-head.ja.md` に詳細の記載がある。
チーム立ち上げの指示なので、必ず最初に読むこと。
各paneの存在を確認し、無ければ起動し、あればClaudeの起動を確認すること。全員を調べ、Claudeが起動していない部下に対し,Claude起動する。


## 実施内容

### 1. 前提理解
1. 資料を読んで、ドメイン設計と Totality を理解する。
2. 理解した結果や調査した結果を `tmp/<branch_name>/` 配下に作成する。

### 2. 作業開始
3. 「問題の背景」に従い、(1)workspaeceとworking_dir, (2)設定ファイル内部の base_dir, app_prompt.base_dir, app_schema.base_dir, (3)CWD, (4)設定ファイル配置場所の関係性を整理する。
4. 整理した内容をもとに、統合案を3つ考える。全域性、ドメイン駆動、実装のAI複雑性制御を総合的に考えること。
5. 考えた内容を `tmp/working_dir_planning.md` へ記述する。現状と変更案を併記する。

#### 完了条件

1. `tmp/working_dir_planning.md`に実装統一の検討案が記載されている
2. ハードコーディングが無くなる案になっている
3. [実装のAI複雑性制御](`docs/breakdown/domain_core/ai-complexity-control_compact.ja.md`) の原則に従い、最小限のコード量で最大の効果を得る案になっている。


# タスクの進め方

- Git:
  - 現在のGitブランチで作業する
- サイクル: 仕様把握 → 調査 → 計画・設計 → 実行 → 記録・検証 → 学習 → 仕様把握へ戻る
- 作業分担: 作業内容をワーカープールマネージャーへ依頼し、ワーカーへの指示を行わせる。チームの常時フル稼働を目指す。

## 進捗更新

- 進捗させるべきタスクは `tmp/<branch_name>/tasks.md` に書き出し、完了マークをつけたりしながら進めてください。
- すべてが完了したら、`tmp/<branch_name>/completed.md` に完了したレポートを記録してください。


# 作業開始指示

まずチームを立ち上げます。
その後、初期タスク（仕様理解、実装調査）を早々にワーカープールマネージャーへ渡します。

続いて、仕様の理解を進め、調査・修正案の作成と実施内容に基づいてワーカープールの稼働を最大化します。
その後は、チーム全体のパフォーマンスが重要です。
常にワーカープールマネージャーと、その部下であるゴルーチンをフル稼働させてください。

今なにをすべきか（タスク分割や、状況整理、要件定義、実装、テスト）について、ワーカープールマネージャーが把握していることが重要です。ワーカープールマネージャーから、今やる詳細タスクへ分割し、部下ゴルーチンへ割り当てさせてください。

プロジェクトの成功を祈ります。開始してください。



