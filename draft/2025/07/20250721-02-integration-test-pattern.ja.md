# プロジェクト: DirectiveType/LayerTypeパターンマッチング統合テスト追加

## チームの構成

あなたは指揮官であり上司である。
最初にチームを立ち上げて進める。

`instructions/team-head.ja.md` に詳細の記載がある。
チーム立ち上げの指示なので、必ず最初に読むこと。
各paneの存在を確認し、無ければ起動し、あればClaudeの起動を確認すること。全員を調べ、Claudeが起動していない部下に対し,Claude起動する。

## 実施内容

## タスクとゴール

```yml
- 信じて良い前提: Breakdown本体はテストをpassして正常に動作する
- タスク: |
  1. 統合テストを1つ追加する |
  2. 設定ファイルのDirectiveType/LayerTypeのパターンマッチングを広くする（a-z0-9） |
  3. 設定のpatternの中でランダムな文字列を生成してbreakdown <random1> <random2>としてテストする |
  4. DirectiveTypeとLayerTypeがPatternマッチングで検証されたことを確認する |
  5. TwoParamsResultの検証までで終了し、パス解決は実装しない |
- ゴール: パターンマッチング機能が正常に動作し、ランダムなDirectiveType/LayerTypeでも適切に処理される。テストは設定読み込み→パターンマッチング→TwoParamsResult生成→結果検証までを実行し、パス解決は実装しない。
```

**注意書き**
- テスト追加前に、 `tests/README.md` と `docs/tests/testing.ja.md` を読むこと
- tests/ 配下のテスト構造を理解してから実装すること
- 修正が必要な場合は、`tests/` 配下のファイルのみ変更可能
- 統合テストは `tests/integration/` 配下に配置すること

### 実行方針

#### 前提理解
1. 資料を読んで、tests/ 配下の構造とテスト方針を理解する
2. DirectiveType/LayerTypeのパターンマッチング仕様を `docs/breakdown/domain_core/two_params_types.ja.md` で確認する
3. 理解した結果や調査した結果を `tmp/<branch_name>/` 配下に作成する

#### 作業開始
4. 現在のDirectiveType/LayerTypeパターンマッチング実装を調査する
5. パターンマッチング設定ファイルのテスト用設定を作成する
6. ランダム文字列生成機能をテスト内に実装する
7. 統合テストを `tests/integration/` 配下に追加する：
   - ランダムなDirectiveType/LayerTypeの組み合わせでテストケースを生成
   - 設定ファイルのパターンマッチングが正しく動作することを検証
   - TwoParamsResultの生成と検証までを実行し、パス解決は実装しない
8. テストを実行して動作確認する
9. 必要に応じてテスト設定の修正を行う

### パターンマッチングテスト仕様

- 現在のパターン: 設定ファイル（*-user.yml）で定義されたパターン
- テスト対象パターン: a-z0-9 の組み合わせ（英数字）を許可する設定
- ランダム文字列生成: 
  - DirectiveType: 3-8文字のランダム英数字
  - LayerType: 3-8文字のランダム英数字
- テストケース数: 最低10パターン以上

### 統合テスト実装要件

1. テストファイル名: `tests/integration/pattern_matching_integration_test.ts`
2. テスト内容:
   - ランダムなDirectiveType/LayerTypeペアの生成
   - 設定ファイルのパターンマッチング機能の動作確認
   - 設定ファイルの正しい読み込み確認
   - TwoParamsResultの生成と結果検証
3. テストデータ:
   - 有効なDirectiveType/LayerTypeパターン（a-z0-9組み合わせ）
   - 無効なパターン（エラーケース）
   - 境界値テストケース
4. テスト用設定ファイル:
   - `tests/fixtures/config/pattern-test-user.yml`
   - a-z0-9パターンマッチングを許可する設定

### 必読資料

- テスト仕様: `docs/tests/testing.ja.md`
- ドメイン仕様: `docs/breakdown/domain_core/two_params_types.ja.md`
- パターンマッチング: `docs/breakdown/domain_core/domain_boundaries_flow.ja.md`
- 統合テスト構造: `tests/integration/` 配下の既存ファイル

### 完了条件

以下の全ての点を満たすこと：

- 統合テストが `tests/integration/` 配下に正しく追加されている
- テスト用設定ファイルでDirectiveType/LayerTypeのパターンマッチングが a-z0-9 パターンで設定されている
- ランダム文字列生成機能がテスト内に実装されている
- 統合テストが全てpassする
- `deno task test` が1つのエラーもなく成功する
- TwoParamsResultの生成と検証が正しく実行されている

**禁止事項**
- lib/ 配下のコア実装ファイルの変更は最小限にとどめること
- examples/ 配下のファイル変更は禁止
- tmp/ 配下以外への不要なファイル作成は禁止
- 既存のテストを破壊する変更は禁止

## タスクの進め方

- Git:
  - 現在のGitブランチで作業する
- サイクル: 仕様把握 → 調査 → 計画・設計 → 実装 → テスト → 記録・検証 → 学習 → 仕様把握へ戻る
- 作業分担: 作業内容をワーカープールマネージャーへ依頼し、ワーカーへの指示を行わせる。チームの常時フル稼働を目指す。

## 進捗更新

- 進捗させるべきタスクは `tmp/<branch_name>/tasks.md` に書き出し、完了マークをつけたりしながら進めてください。
- すべてが完了したら、`tmp/<branch_name>/completed.md` に完了したレポートを記録してください。

## 作業開始指示

まずチームを立ち上げます。
その後、初期タスク（仕様理解、実装調査）を早々にワーカープールマネージャーへ渡します。

続いて、テスト仕様の理解を進め、統合テスト実装方針に基づいてワーカープールの稼働を最大化します。
その後は、チーム全体のパフォーマンスが重要です。
常にワーカープールマネージャーと、その部下であるゴルーチンをフル稼働させてください。

今なにをすべきか（タスク分割や、状況整理、要件定義、実装、テスト）について、ワーカープールマネージャーが把握していることが重要です。ワーカープールマネージャーから、今やる詳細タスクへ分割し、部下ゴルーチンへ割り当てさせてください。

プロジェクトの成功を祈ります。開始してください。
